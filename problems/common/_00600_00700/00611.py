#!/usr/bin/env python
# coding=utf-8
# ============================================================
# https://leetcode.cn/problems/valid-triangle-number/description/
# ============================================================
"""
给定一个包含非负整数的数组 nums ，返回其中可以组成三角形三条边的三元组个数。
"""
from typing import List

from helper.func import func_cost_wrapper


class Solution:
    """
    所有三元组的组合数目有C(n,3)个=O(n^3)，不能全部枚举，需要剪枝
    三边构成三角形：两短边之和小于第三边
    可以对num排序，计算出小于i的数目有多少个
    """

    # @func_cost_wrapper
    def triangleNumber(self, nums: List[int]) -> int:
        if len(nums) < 3:
            return 0
        nums = sorted(nums)
        # print(nums)
        results = 0
        n = len(nums)

        last = -1
        # less_nums[i]: nums中小于i的数字有less_nums[i]个
        less_nums = []
        for i in range(0, n):
            if nums[i] != last:
                last = nums[i]
                less_nums.extend([i] * (nums[i] - len(less_nums) + 1))
        less_nums.extend([n] * (nums[-1] + nums[-2]))

        # 0 ~ n - 3
        for i in range(0, n - 2):
            # i ~ n - 2
            for j in range(i + 1, n - 1):
                # j + 1 ~ n - 1
                now = nums[i] + nums[j]
                this_total = less_nums[min(now, len(less_nums) - 1)] - j - 1
                if this_total > 0:
                    results += this_total
        return results


if __name__ == '__main__':
    solution = Solution

    for idx, (i, o) in enumerate([
        ([2, 2, 3, 4], 3),
        ([4, 2, 3, 4], 4),
        ([1, 2, 3, 4, 5], 3),
        ([i for i in range(1000)], 82709749),
        ([278, 513, 154, 216, 742, 535, 172, 176, 159, 698, 622, 156, 80, 632, 254, 233, 330, 346, 682, 908, 802, 869,
          74, 104, 142, 450, 116, 233, 195, 334, 540, 491, 910, 720, 456, 873, 130, 833, 935, 853, 319, 169, 85, 496,
          378, 25, 859, 364, 832, 592, 950, 610, 478, 898, 221, 291, 441, 803, 567, 986, 283, 978, 446, 735, 796, 944,
          217, 95, 109, 649, 761, 536, 640, 155, 902, 50, 897, 791, 604, 14, 609, 577, 731, 606, 742, 253, 667, 492,
          922, 955, 185, 823, 282, 379, 821, 157, 319, 2, 857, 198, 531, 496, 978, 436, 459, 973, 481, 610, 8, 220, 809,
          431, 831, 559, 694, 240, 871, 804, 682, 133, 305, 45, 447, 852, 102, 134, 585, 247, 118, 802, 530, 443, 167,
          115, 68, 664, 33, 569, 470, 494, 827, 43, 794, 412, 403, 133, 935, 912, 341, 870, 576, 923, 350, 479, 472,
          119, 339, 46, 858, 60, 817, 733, 613, 57, 271, 767, 477, 426, 986, 537, 64, 569, 179, 543, 118, 863, 703, 191,
          675, 967, 300, 185, 618, 642, 139, 170, 154, 449, 187, 318, 770, 228, 233, 699, 641, 752, 949, 145, 855, 383,
          475, 539, 481, 7, 400, 723, 52, 983, 217, 169, 336, 767, 468, 529, 676, 798, 444, 62, 164, 438, 451, 749, 962,
          243, 220, 492, 740, 579, 653, 3, 72, 642, 843, 963, 777, 46, 125, 721, 295, 111, 201, 653, 452, 494, 89, 951,
          483, 26, 212, 718, 760, 640, 410, 827, 734, 412, 390, 207, 57, 657, 91, 743, 969, 89, 511, 604, 689, 346, 530,
          209, 54, 823, 267, 402, 975, 772, 74, 867, 124, 135, 359, 337, 674, 183, 673, 535, 217, 689, 249, 267, 459,
          963, 870, 879, 984, 888, 91, 655, 30, 963, 101, 202, 199, 596, 915, 594, 765, 212, 778, 285, 781, 722, 539,
          624, 991, 939, 788, 12, 915, 84, 972, 607, 754, 654, 796, 514, 973, 284, 594, 377, 787, 547, 870, 752, 859,
          62, 752, 365, 869, 646, 88, 323, 601, 26, 624, 241, 674, 363, 665, 45, 933, 260, 700, 798, 349, 335, 40, 250,
          532, 538, 886, 54, 375, 930, 405, 661, 882, 915, 820, 636, 519, 837, 65, 534, 157, 806, 604, 350, 169, 272,
          17, 409, 176, 485, 701, 447, 443, 900, 78, 517, 815, 792, 4, 307, 510, 600, 409, 295, 803, 96, 271, 184, 405,
          140, 891, 61, 202, 424, 251, 18, 125, 882, 312, 721, 632, 346, 88, 781, 640, 702, 611, 475, 365, 364, 9, 777,
          870, 963, 504, 548, 872, 565, 591, 624, 37, 778, 875, 498, 504, 576, 135, 271, 83, 525, 623, 504, 190, 187,
          645, 998, 860, 413, 482, 242, 634, 234, 176, 941, 968, 694, 827, 841, 598, 87, 846, 797, 395, 83, 740, 591,
          738, 977, 353, 328, 26, 595, 320, 210, 240, 748, 930, 865, 430, 572, 977, 655, 724, 74, 378, 604, 380, 432, 8,
          917, 982, 726, 112, 90, 678, 31, 866, 90, 974, 651, 89, 771, 67, 514, 570, 817, 174, 842, 610, 442, 35, 141,
          181, 88, 524, 83, 100, 165, 537, 669, 194, 603, 281, 321, 176, 455, 945, 506, 5, 433, 711, 170, 828, 291, 817,
          855, 706, 851, 732, 981, 600, 168, 110, 330, 930, 457, 120, 848, 435, 113, 250, 124, 51, 527, 18, 42, 964,
          370, 801, 631, 21, 154, 821, 564, 373, 326, 457, 365, 624, 778, 370, 356, 912, 164, 192, 139, 385, 863, 443,
          800, 815, 526, 337, 803, 401, 153, 171, 511, 636, 672, 663, 548, 421, 595, 427, 556, 894, 450, 193, 495, 406,
          99, 642, 976, 246, 710, 531, 923, 741, 62, 681, 835, 148, 411, 19, 942, 425, 762, 429, 769, 950, 188, 205, 31,
          766, 82, 614, 602, 804, 981, 666, 134, 750, 107, 619, 554, 597, 577, 52, 744, 837, 207, 754, 959, 310, 857,
          365, 310, 656, 764, 850, 627, 35, 829, 792, 736, 474, 255, 111, 759, 891, 296, 717, 301, 412, 212, 35, 879,
          963, 47, 938, 431, 689, 257, 505, 521, 790, 218, 729, 303, 311, 610, 659, 713, 555, 531, 234, 452, 982, 512,
          554, 732, 40, 902, 731, 478, 10, 159, 473, 38, 725, 783, 385, 69, 522, 991, 836, 303, 946, 819, 687, 568, 5,
          768, 99, 884, 754, 400, 27, 128, 277, 457, 577, 470, 306, 5, 52, 163, 372, 173, 526, 731, 732, 230, 824, 819,
          517, 517, 901, 291, 725, 436, 804, 658, 909, 782, 911, 243, 330, 821, 404, 901, 188, 737, 259, 54, 457, 910,
          524, 172, 142, 951, 132, 743, 316, 309, 87, 813, 521, 738, 156, 989, 735, 543, 914, 331, 938, 149, 47, 919,
          422, 281, 245, 350, 35, 375, 241, 171, 884, 261, 374, 79, 980, 980, 386, 738, 215, 368, 514, 127, 597, 997,
          367, 813, 466, 821, 521, 433, 529, 784, 151, 108, 526, 832, 731, 402, 485, 218, 261, 382, 313, 338, 738, 558,
          603, 311, 340, 696, 283, 907, 99, 132, 244, 912, 506, 523, 115, 251, 235, 1, 576, 945, 806, 372, 214, 702,
          548, 270, 936, 938, 153, 182, 210, 718, 951, 402, 327, 574, 698, 613, 960, 98, 806, 423, 553, 150, 753, 301,
          176, 425, 475, 884, 420, 749, 231, 212, 755, 140, 33, 740, 353, 57, 563, 328, 106, 315, 534, 938, 31, 679,
          105, 599, 133, 702, 548, 543, 85, 57, 179, 159, 84, 98, 789, 284, 288, 426, 791, 836, 907, 883, 59, 703, 836,
          872, 821, 34, 51, 522, 620, 418, 739, 783, 184, 470, 485, 416, 710, 306, 241, 799, 540, 98, 462, 532, 682,
          490, 336, 384, 911, 700, 62, 139, 469, 946, 949, 209, 385, 359, 150, 810, 338, 197, 834, 84, 915, 999, 1000,
          819, 896, 843, 98, 99, 575], 71987430),
        ([0, 0, 0, 7], 0),
        ([159, 541, 20, 407, 803, 718, 353, 865, 664, 64, 536, 613, 512, 259, 195, 718, 119, 762, 825, 336, 135, 690,
          216, 557, 655, 409, 671, 592, 665, 206, 107, 186, 962, 84, 531, 725, 711, 320, 258, 947, 22, 60, 606, 220,
          427, 340, 392, 18, 923, 632, 693, 604, 316, 118, 318, 629, 543, 241, 970, 895, 620, 475, 556, 439, 678, 754,
          634, 634, 624, 388, 593, 422, 196, 739, 717, 176, 543, 128, 769, 193, 887, 513, 906, 985, 124, 119, 187, 352,
          539, 29, 924, 864, 26, 204, 252, 475, 23, 532, 981, 20, 658, 578, 554, 836, 428, 356, 690, 247, 171, 483, 533,
          940, 613, 647, 467, 910, 647, 692, 379, 71, 377, 789, 630, 271, 654, 281, 502, 514, 941, 812, 519, 955, 931,
          405, 741, 505, 887, 841, 11, 530, 974, 324, 906, 28, 550, 761, 297, 964, 694, 230, 892, 897, 631, 630, 720,
          439, 622, 301, 401, 507, 283, 675, 961, 893, 848, 780, 383, 801, 703, 384, 499, 589, 32, 445, 308, 590, 680,
          964, 991, 799, 37, 381, 230, 545, 332, 745, 765, 683, 677, 378, 761, 133, 239, 346, 394, 889, 99, 264, 159,
          333, 271, 394, 79, 635, 730, 42, 710, 304, 685, 69, 424, 214, 307, 821, 538, 365, 293, 862, 377, 736, 933,
          607, 223, 12, 888, 29, 770, 72, 921, 981, 387, 380, 42, 111, 127, 722, 609, 285, 154, 2, 615, 920, 233, 512,
          972, 618, 651, 457, 528, 778, 785, 102, 527, 806, 810, 219, 714, 924, 969, 689, 63, 437, 26, 897, 27, 591,
          854, 768, 334, 8, 98, 887, 573, 568, 341, 965, 98, 332, 839, 175, 635, 672, 239, 249, 51, 68, 994, 478, 496,
          489, 421, 581, 794, 60, 544, 465, 307, 771, 780, 266, 346, 973, 243, 265, 113, 895, 751, 200, 689, 303, 64,
          564, 217, 798, 272, 484, 411, 705, 133, 269, 194, 290, 359, 867, 479, 120, 806, 924, 729, 233, 270, 276, 501,
          396, 563, 43, 934, 773, 114, 160, 882, 822, 231, 865, 814, 55, 488, 539, 617, 437, 916, 600, 483, 750, 40,
          197, 178, 100, 454, 987, 320, 40, 595, 139, 172, 464, 455, 588, 278, 555, 409, 973, 221, 301, 652, 238, 579,
          914, 774, 475, 839, 311, 570, 117, 296, 127, 106, 643, 269, 149, 317, 195, 624, 801, 552, 314, 316, 500, 434,
          519, 243, 229, 375, 882, 141, 574, 397, 315, 384, 851, 920, 143, 345, 244, 234, 945, 661, 706, 340, 601, 572,
          774, 135, 184, 215, 657, 97, 448, 927, 351, 669, 813, 723, 745, 712, 642, 98, 790, 224, 438, 694, 36, 319,
          996, 689, 435, 769, 417, 224, 849, 882, 668, 984, 497, 798, 774, 466, 773, 965, 373, 719, 324, 53, 285, 747,
          660, 643, 735, 849, 486, 745, 34, 400, 910, 361, 804, 292, 817, 407, 31, 149, 141, 970, 826, 247, 167, 372,
          350, 285, 689, 372, 444, 272, 553, 46, 897, 385, 377, 299, 113, 917, 282, 105, 915, 729, 613, 87, 50, 17, 550,
          420, 230, 533, 229, 789, 814, 829, 942, 730, 165, 751, 496, 477, 978, 23, 695, 216, 583, 418, 875, 118, 380,
          844, 794, 849, 584, 263, 523, 65, 708, 481, 46, 781, 582, 99, 198, 909, 975, 94, 930, 380, 526, 968, 948, 994,
          258, 424, 841, 12, 149, 17, 467, 81, 208, 636, 153, 781, 126, 472, 13, 672, 930, 343, 68, 760, 523, 51, 601,
          880, 582, 732, 94, 391, 265, 972, 517, 120, 316, 845, 900, 856, 773, 377, 911, 649, 869, 971, 259, 75, 498,
          330, 592, 114, 462, 764, 565, 313, 744, 585, 874, 328, 331, 67, 360, 34, 602, 773, 210, 597, 535, 928, 597,
          480, 428, 502, 368, 605, 333, 795, 278, 102, 680, 169, 661, 34, 50, 917, 532, 326, 907, 613, 163, 649, 969,
          897, 60, 325, 108, 365, 456, 185, 2, 538, 815, 574, 241, 487, 382, 108, 105, 908, 147, 393, 192, 670, 578,
          688, 212, 152, 715, 362, 509, 575, 571, 310, 195, 898, 776, 49, 519, 941, 964, 424, 864, 809, 312, 669, 815,
          607, 397, 361, 736, 615, 2, 726, 818, 165, 656, 540, 776, 784, 33, 66, 319, 204, 952, 495, 691, 341, 331, 138,
          524, 878, 755, 611, 705, 361, 296, 898, 854, 264, 784, 510, 217, 267, 692, 599, 356, 659, 465, 149, 636, 840,
          327, 332, 467, 268, 363, 94, 120, 150, 169, 254, 206, 979, 834, 79, 913, 919, 570, 596, 141, 397, 530, 564,
          504, 379, 145, 726, 286, 109, 10, 721, 733, 374, 100, 455, 702, 12, 332, 984, 653, 849, 681, 945, 591, 716,
          138, 708, 238, 948, 752, 159, 406, 531, 839, 7, 821, 381, 118, 927, 457, 352, 156, 158, 746, 479, 711, 703,
          290, 687, 764, 820, 986, 799, 328, 23, 563, 531, 89, 576, 837, 202, 423, 508, 808, 960, 663, 833, 103, 289,
          941, 503, 87, 964, 808, 498, 105, 475, 116, 400, 319, 879, 960, 197, 248, 576, 517, 741, 260, 879, 307, 788,
          469, 607, 859, 567, 253, 660, 43, 3, 530, 486, 564, 445, 896, 951, 752, 411, 269, 531, 717, 216, 794, 178,
          652, 844, 909, 306, 4, 778, 164, 186, 846, 271, 665, 150, 882, 521, 953, 196, 734, 429, 184, 113, 992, 236,
          189, 940, 701, 375, 682, 233, 551, 439, 945, 643, 486, 415, 834, 682, 421, 196, 704, 290, 693, 23, 929, 400,
          379, 752, 320, 226, 291, 700, 179, 199, 313, 781, 183, 540, 915, 316, 17, 822, 298, 101, 264, 31, 30, 515,
          290, 800, 671, 879, 462, 934, 78, 802, 53, 454, 797, 100, 598, 722, 341, 688, 676, 685, 785, 245, 100, 238,
          529, 278, 101, 623, 900, 841, 190, 843, 562, 931, 454, 515, 817, 779, 136, 471, 399, 91, 318, 977, 436, 926,
          784, 657, 199, 121, 248, 684, 607, 542, 940, 976, 650, 778, 324, 938, 646, 646, 653, 847], 82585420),
    ]):
        print(f'case {idx}: {i}')
        print(f'	predict: {o}')
        print(f'\toutput: {solution().triangleNumber(i)}')
